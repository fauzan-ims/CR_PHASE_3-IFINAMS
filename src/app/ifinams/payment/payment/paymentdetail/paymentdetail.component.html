<div class="main-content">
    <!-- spinner region -->
    <div class="panel-container-spinner" *ngIf="showSpinner">
        <app-spinner class="spinner-container"></app-spinner>
    </div>
    <!-- end spinner region -->
    <div class="row">
        <div class="col-md-12">
            <div class="card ">
                <!--#region watermark-->
                <div class="watermark" [hidden]="this.isWatermark === '0'">
                    <h6>{{this.companyName}}</h6>
                    <h6>{{this.userName}}</h6>
                    <h6>{{this.sysDate | date}} {{this.currentTime}}</h6>
                </div>
                <!--#endregion watermark-->
                <!-- <div class="card"> -->
                <div class="card-header ">
                    <h5 class="card-title">Payment Info</h5>
                </div>
                <div class="card-body ">
                    <!--#region form-->
                    <form #OpnameForm="ngForm" (ngSubmit)="onFormSubmit(OpnameForm.value, OpnameForm.valid)">
                        <!--#region registerDetail form-->
                        <!--#region registerDetail button submit dan back-->
                        <button type="submit" class="btn btn-info btn-round" [hidden]="model.payment_status != 'HOLD'"
                            data-role="R00023960000003C">Save</button>

                        <button [hidden]="this.PaymentCode == null || model.payment_status !== 'HOLD'" type="button"
                            class="btn btn-success btn-round" (click)="btnProceed()"
                            data-role="R00023960000004O">Proceed</button>

                        <button hidden type="button" class="btn btn-success btn-round" (click)="btnPost()"
                            data-role="R00023960000007O">Post</button>

                        <button [hidden]="this.PaymentCode == null || model.payment_status !== 'HOLD'" type="button"
                            class="btn btn-warning btn-round" (click)="btnCancel()"
                            data-role="R00023960000005R">Cancel</button>

                        <button
                            [hidden]="this.PaymentCode == null || model.payment_status != 'ON PROCESS' && model.payment_status != 'APPROVE' && model.payment_status != 'HOLD'"
                            type="button" style='float: right;' class="btn btn-success btn-round custom-button-width"
                            (click)="btnViewApproval()" data-toggle="modal" data-target="#lookupModalApproval" href="#">
                            View Approval
                        </button>


                        <button type="button" class="btn btn-danger btn-round" (click)="btnBack()">Back</button>
                        <!--#publicservice detail button submit dan back-->

                        <!--#region publicservice detail row-->
                        <div class="row">
                            <!--#region code-->
                            <div class="col-md-4">
                                <div [hidden]="model.code != null" class="row"
                                    style="margin-bottom: -15px; padding-top: 30px;">
                                    <h1 class="col-md-4" style="font-size: 12px;">Code</h1>
                                    <h1 class="col-md-8" style="font-size: 12px;">-Auto
                                        Generate-</h1>
                                </div>
                                <div [hidden]="model.code == null" class="form-group">
                                    <label>Code </label>
                                    <input type="text" class="form-control" placeholder="Enter Code"
                                        [ngModel]="model.code" name="p_code" readonly>
                                </div>
                            </div>
                            <!--#endregion code-->

                            <!--#region publicserviceAddresDetail Branch Code-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label labelmodule">Branch *</label>
                                    <div class="col-md-12 buttons btn-lookup-margin">
                                        <span>
                                            <button class="btn btn-icon btn-outline-default btn-round btn-md"
                                                type="button" [disabled]="isReadOnly" (click)="btnLookupBranch()"
                                                data-toggle="modal" data-target="#lookupModalBranch" href="#"><i
                                                    class="fa fa-search-plus" readonly></i></button>
                                            {{model.branch_name}}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <!--#endregion publicserviceAddresDetail Branch Code-->

                            <!--#region Payment Status -->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Status</label>
                                    <input type="text" class="form-control" readonly maxlength="20"
                                        [ngModel]="model.payment_status" name="p_payment_status">
                                </div>
                            </div>
                            <!--#endregion  Payment Status-->

                            <!--#region Register date-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="payment_transaction_date" class="control-label">Date *</label>
                                    <div>
                                        <input [ngStyle]="getStyles(true)" class="form-control col-md-6"
                                            placeholder="dd/mm/yyyy" angular-mydatepicker
                                            [ngModel]="model.payment_transaction_date" name="p_payment_transaction_date"
                                            [options]="myDatePickerOptions" #p_payment_transaction_date="ngModel"
                                            #payment_transaction_date="angular-mydatepicker" autocomplete="off"
                                            (click)="payment_transaction_date.toggleCalendar()" readonly />
                                    </div>
                                </div>
                            </div>
                            <!--#endregion Register date-->

                            <!--#region payment-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="payment_amount" class="control-label">Amount</label>
                                    <div class="col-md-6" style="margin-left: -15px;">
                                        <input style="text-align:right" class="form-control"
                                            [ngModel]="model.payment_amount | number : '1.2-2'" amount="payment_amount"
                                            name="p_payment_amount" #transaction_amount="ngModel" readonly />
                                    </div>
                                </div>
                            </div>
                            <!--#endregion payment-->

                            <!--#region Payment Remarks-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="remark" class="control-label">Remark</label>
                                    <textarea type="text" class="form-control" [ngModel]="model.remark" name="p_remark"
                                        #remark="ngModel" readonly></textarea>
                                </div>
                            </div>
                            <!--#endregion  Register Remarks-->

                            <!--#region payment_to -->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Payment To</label>
                                    <input type="text" class="form-control" readonly maxlength="250"
                                        [ngModel]="model.payment_to" name="p_payment_to">
                                </div>
                            </div>
                            <!--#endregion  payment_to-->

                            <!--#region look up to bank name-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label labelmodule">To Bank</label>
                                    <div class="col-md-12 buttons btn-lookup-margin">
                                        <span>
                                            <button class="btn btn-icon btn-outline-default btn-round btn-md"
                                                type="button" disabled data-toggle="modal" data-target="#lookupModal"
                                                href="#"><i class="fa fa-search-plus"></i></button>
                                            {{model.to_bank_name}}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <!--#endregion look up to bank name-->

                            <!--#region Bank Account No-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="to_bank_account_no" class="control-label">To Bank Account No</label>
                                    <input type="text" class="form-control" [ngModel]="model.to_bank_account_no"
                                        maxlength="50" name="p_to_bank_account_no" #to_bank_account_no="ngModel"
                                        readonly>
                                </div>
                            </div>
                            <!--#endregion Bank Account No-->

                            <!--#region Bank Account Name-->
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="to_bank_account_name" class="control-label">To Bank Account Name
                                    </label>
                                    <input type="text" class="form-control" [ngModel]="model.to_bank_account_name"
                                        maxlength="250" name="p_to_bank_account_name" #to_bank_account_name="ngModel"
                                        readonly>
                                </div>
                            </div>
                            <!--#endregion Bank Account Name-->

                            <!--#region file name-->
                            <div class="col-md-4" [hidden]="this.model.code == null">
                                <div class="form-group row" style="margin-left: 30px;">
                                    <label>Attachment</label>
                                    <div class="fileinput fileinput-new text-center" data-provides="fileinput">
                                        <div [hidden]="model.payment_status !== 'HOLD' || this.model.file_name !== ''">
                                            <!-- <div [hidden]="this.tampHidden == true"> -->
                                            <span class="btn btn-info btn-round btn-file">
                                                <input type="file" (change)="onUpload($event, this.PaymentCode)"
                                                    id="fileControl" />
                                                <span><i class="fa fa-check"></i></span>
                                            </span>
                                            {{tempFile}}
                                        </div>
                                        <!-- <div [hidden]="this.tampHidden == true"> -->
                                        <div [hidden]="model.file_name === ''">
                                            <span>
                                                <a class="btn btn-danger btn-round btn-file " type="button"
                                                    (click)="deleteImage(model.file_name, model.paths)"
                                                    [hidden]="model.payment_status!=='HOLD'">
                                                    <span><i class="fa fa-trash"></i></span></a>
                                                <a class="btn btn-primary btn-round btn-file " type="button"
                                                    (click)="previewFile(model.file_name, model.paths)">
                                                    <span><i class="fa fa-eye"></i></span></a>
                                            </span>
                                            <div>{{model.file_name}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--#endregion file name-->
                        </div>
                    </form>
                    <!--#endregion form-->
                </div>
                <!--#endregion-->

                <span layout="row horizontal-divider">
                    <hr flex />
                </span>
                <div *ngIf="PaymentCode != null" class="row">
                    <div class="col-md-12">
                        <!--#region list header detail-->
                        <div class="card-header">
                            <h4 class="card-title">Payment Detail List </h4>
                        </div>
                        <div class="card-body">
                            <!--#region button add-->
                            <div class="toolbar">
                                <button class="btn btn-danger btn-round" (click)="btnDeleteAll()"
                                    [hidden]="model.payment_status !== 'HOLD'" data-role="R00023960000006D">
                                    Delete
                                </button>
                            </div>
                            <!--#endregion button add-->

                            <!--#region list view-->
                            <table id="datatablepaymentdetaillist" datatable [dtOptions]="dtOptions"
                                class="table table-striped table-bordered row-border hover" cellspacing="0"
                                width="100%">
                                <thead>
                                    <tr>
                                        <th class="disabled-sorting">No</th>
                                        <th class="disabled-sorting">
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="form-check-input" type="checkbox" id="checkalltable"
                                                        [(ngModel)]="selectedAllTable" (change)="selectAllTable();" />
                                                    <span class="form-check-sign"></span>
                                                </label>
                                            </div>
                                        </th>
                                        <th>Request No</th>
                                        <th>Source No</th>
                                        <th>Source</th>
                                        <th>Remark</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let row of paymentdetaillist; let i = index">
                                        <td style="text-align: center;">{{paymentdetaillist.numberIndex+i+1}}</td>
                                        <td class="disabled-sorting">
                                            <div class="form-check">
                                                <label class="form-check-label">
                                                    <input class="form-check-input" type="checkbox"
                                                        [(ngModel)]="row.selected"
                                                        (change)="checkIfAllTableSelected($event, row.id);">
                                                    <span class="form-check-sign"></span>
                                                </label>
                                            </div>
                                        </td>
                                        <td class="if-no-edit-btn" style="text-align: center;width: 15%;">
                                            {{row.payment_request_code}}</td>
                                        <td style="text-align: center;width: 15%;">{{row.payment_source_no}}</td>
                                        <td style="text-align: left;width: 15%;">{{row.payment_source}}</td>
                                        <td style="text-align: left;width: 40%;">{{row.payment_remarks}}</td>
                                        <td style="text-align: right;width: 15%;"> {{row.orig_amount | number :'1.2-2'}}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!--#endregion list view-->
                        </div>
                        <!--#endregion list header detail-->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!--#region lookup Branch-->
<div class="modal bd-example-modal-lg" tabindex="-1" aria-hidden="true" id="lookupModalBranch"
    style="margin-top: -65px">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" style="overflow:hidden;">
                <div class="col-md-12">
                    <div class="card-body col-md-12">

                        <table id="datatableLookupBranch" class="table table-striped table-bordered hover"
                            cellspacing="0" style="min-width: 100%;">
                            <thead>
                                <tr>
                                    <th class="disabled-sorting">No</th>
                                    <th>Code</th>
                                    <th>Branch Name</th>
                                    <th style="text-align: center; width: 5%;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let row of lookupbranch; let i=index">
                                    <td style="text-align: center;">{{lookupbranch.numberIndex+i+1}}</td>
                                    <td style="text-align: center; width: 25%;">{{ row.code }}</td>
                                    <td style="text-align: left; width: 75%;">{{ row.name }}</td>
                                    <td class="text-center">
                                        <button class="btn btn-outline-default btn-round"
                                            (click)="btnSelectRowBranch(row.code, row.name)">Select</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--#endregion lookup Branch-->

<!--#region lookup Approval-->
<div class="modal bd-example-modal-lg" tabindex="-1" aria-hidden="true" id="lookupModalApproval"
    style="margin-top: -65px">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" style="overflow:hidden;">
                <div class="col-md-12">
                    <div class="card-body col-md-12">

                        <table id="datatableLookupApproval" class="table table-striped table-bordered hover"
                            cellspacing="0" style="min-width: 100%;">
                            <thead>
                                <tr>
                                    <th style="display: none;"></th>
                                    <th class="disabled-sorting">No</th>
                                    <th>Employee</th>
                                    <th>Position</th>
                                    <th>Level</th>
                                    <th>Result</th>
                                    <th>Remark</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let row of lookupapproval;let i=index ">
                                    <td style="display: none;"></td>
                                    <td style="text-align: center;">{{lookupapproval.numberIndex+i+1}}</td>
                                    <td class="if-no-edit-btn" style="width: 30%;text-align: left;">
                                        {{row.emp_name}} {{row.is_mandatory_level}}</td>
                                    <td style="width: 20%;text-align: left;">{{row.emp_position_name}}</td>
                                    <td style="width: 5%;text-align: center;">{{row.approval_level}}</td>
                                    <td style="width: 15%;text-align: center;">
                                        {{row.result_status}}<br>
                                        {{row.result_date}}
                                    </td>
                                    <td style="width: 30%;">{{row.result_remarks}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--#endregion lookup Approval-->